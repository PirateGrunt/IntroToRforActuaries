---
author: "Brian A. Fannin"
output: slidy_presentation
duration: 30
fig_height: 4
fig_width: 10
title: "Advanced Modeling"
---

---

Continuous, or nearly continuous*  data models very well. However, actuaries often work with "grouped" data. We can map these to integers, but the numbers convey no meaning.

* State
* Agency
* Line of business

(integer, but can take many values, e.g. Poisson)

# Quick model

```{r }
set.seed(1234)
N <- 100
x <- exp(rnorm(N, log(1000)))
x <- rnorm(N, 1000, 300)
link <- 1.5

# scale and center around 1.0. Use an inverse logit function to scale from 
# random normal -> [0,1]
groupVals <- rnorm(5)
groupVals <- exp(groupVals) / (exp(groupVals) + 1)
groupVals <- groupVals - 0.5

names(groupVals) <- c("red", "blue", "green", "yellow", "orange")
e <- rnorm(length(x), sqrt(mean(x)), 2 * sqrt(mean(x)))
b2 <- sample(groupVals, length(x), replace=TRUE)

y <- b1 * x + b2 * x + e
df <- data.frame(y = y
                 , x = x
                 , b1 = b1
                 , group = names(b2)
                 , groupVal = b2
                 , e = e 
                 , Link = y / x
                 , stringsAsFactors = FALSE)

plot(y ~ x, data=df, col=df$group, pch=20)

fit1 <- lm(y ~ x + group, data = df)
summary(fit1)

fit2 <- lm(y ~ 0 + x + group, data = df)
summary(fit2)

fit3 <- lm(y ~ 0 + x:group, data = df)
summary(fit3)

# Plotting the fit lines is an exercise for the student.
```

# One group at a time


```{r }
lstSplit <- split(df, df$group)
fits <- lapply(lstSplit, function(z){
  fit <- lm(y ~ 0 + x, data = z)
  fit
})

summary(fits[[1]])
summary(fits[[2]])
summary(fits[[3]])
```

##

Grouped data is separated data.

Using grouped information is like playing a piano. There are no notes between the keys.

Using a hierarchical model is like slide guitar.



## See also:

* Guszcza's hierarchical growth model paper
